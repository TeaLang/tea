#!/usr/bin/env php
<?php
/**
 * This file is part of the Tea programming language project
 *
 * @author 		Benny <benny@meetdreams.com>
 * @copyright 	(c)2019 YJ Technology Ltd. [http://tealang.org]
 * For the full copyright and license information, please view the LICENSE file that was distributed with this source code.
 */

/// The complier script for the Tea programming language

namespace Tea;

define('BASE_PATH', dirname(__DIR__) . '/');
define('LOG_PATH', BASE_PATH . 'log/');

const DEBUG = 0;
const OPTION_KEYS = ['init'];
const USAGE = 'usage:
	tea tea/tests/syntax
	tea --init myproject/hello';

require BASE_PATH . 'compiler/__unit.php';

try {
	$opts = process_cli_options($argv, OPTION_KEYS);

	$dir = $opts[0] ?? null;
	if ($dir === null) {
		error("Missed target dir for compile.");
		halt(USAGE);
	}

	$realpath = FileHelper::get_normalized_path($dir);
	if ($realpath === false) {
		error("Target dir '{$dir}' not found.");
		halt(USAGE);
	}

	echo NL;

	$realpath .= DS;
	$compiler = new Compiler($realpath);
	$count = $compiler->make();

	halt("$count programs compiled.");
}
catch (\Exception $e) {
	halt($e->getMessage());
	// echo $e->getTraceAsString(), NL, NL;
}
